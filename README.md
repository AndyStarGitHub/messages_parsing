# messages_parsing

Програма для парсинґу повідомлень з файлу `messages_to_parse.dat`,
витягування всіх URL, перевірки їх доступності та (опційно) розкриття
скорочених посилань (unshorten).

------------------------------------------------------------------------

## Функціонал

Програма виконує такі кроки:

1.  **Завантаження даних**
    -   Читає файл `data/messages_to_parse.dat` за допомогою модуля
        `pickle`.
    -   Один раз завантажує структуру даних (у нашому випадку це список з
        641 елемента).
2.  **Обмеження кількості записів (DEBUG_LIMIT)**
    -   На початку програми задається константа `DEBUG_LIMIT`.
    -   Якщо `DEBUG_LIMIT = None` -- обробляються всі повідомлення.\
    -   Якщо `DEBUG_LIMIT` -- число, обробляються тільки перші
        `DEBUG_LIMIT` елементів.
    -   Це зручно для відлагодження, щоб не сканувати весь файл.
3.  **Витягування URL (URLExtract)**
    -   Для кожного повідомлення текст приводиться до `str(...)`.
    -   За допомогою `URLExtract` знаходяться всі URL у тексті.
    -   Дублікати прибираються за допомогою `set`, в результаті маємо
        список унікальних URL.
4.  **Перевірка доступності URL (requests.head)**
    -   Для кожного URL виконується HTTP-запит `requests.head` з
        параметрами:
        -   `allow_redirects=True`
        -   `timeout=...` (конфігурований таймаут).
    -   Якщо URL не містить схеми (`http://` / `https://`), вона
        додається автоматично.
    -   Запити виконуються у потоках (`ThreadPoolExecutor`) для
        прискорення роботи.
    -   На виході формується словник:\
        `original_to_status = { "<URL>": <status_code>, ... }`
5.  **Розкриття скорочених URL (unshorten)**
    -   Скорочені URL визначаються за доменами "скорочувачів" (`bit.ly`,
        `t.co`, `newspr.es`, `ow.ly`, `ti.me` тощо). Цей перелік можна розширювати.
    -   Для розкриття використовується `requests.get` з
        `allow_redirects=True`.
    -   Фінальний URL -- це адреса, на яку відбувається переадресація.
    -   Формується словник:\
        `original_to_unshortened = { "<оригінальний URL>": "<фінальний URL>", ... }`
6.  **Лоґування (loguru)**
    -   Лоґи пишуться у консоль і у файли з ротацією:
        -   новий файл кожні 5 хвилин,
        -   автоматичне видалення старших за 20 хвилин.
        
    Примітка. В нашому випадку ротація і автоматичне видалення не спрацюють, тому що 
    програма виконується менше ніж 5 хвилин. Для перевірки, що цей функціонал дійсно
    працює можна тимчасово поставити малий час ротації (наприклад 5 чи 20 секунд).
7.  **Замір загального часу виконання**
    -   Фіксується на початку та в кінці `main()`.

------------------------------------------------------------------------

### Загальна кількість унікальних URL: **71**

### Порівняння режимів unshorten
Режими налаштовуються в конфігурації програми.

### Порівняння режимів unshorten

| Режим | Опис                           | `len(original_to_status)` | `len(original_to_unshortened)` | Час (сек) |
|-------|--------------------------------|----------------------------|---------------------------------|-----------|
| **6.1** | Розкриваємо тільки скорочувачі | 71                         | 43                              | 41.637    |
| **6.2** | Розкриваємо всі URL            | 71                         | 71                              | 50.764    |
| **both** | Як 6.2 + додаткова статистика  | 71                         | 71                              | 55.171    |


## Threading: чому саме потоки?

Операції `HEAD` та `GET` -- це **I/O-bound** завдання.\
Вони чекають відповідей від серверів, тому:

-   потоки дають можливість паралельно чекати декілька запитів;
-   прискорюють виконання у 3--10 разів.

------------------------------------------------------------------------

## Швидкий старт (Windows PowerShell / Linux / macOS)

### 1) Клон/копіювання проєкту та створення віртуального середовища
```bash
git clone https://github.com/AndyStarGitHub/messages_parsing.git
cd messages_parsing

# створіть та активуйте віртуальне середовище
python -m venv .venv
# Windows PowerShell
.venv\scripts\activate
# Linux/macOS
# source .venv/bin/activate
```

### 2) Встановіть залежності
```bash
pip install -r requirements.txt

python main.py
```
Файл лоґів з'явиться в директорії `logs/`.

------------------------------------------------------------------------

## Структура проєкту

    messages_parsing/
    │
    ├─ data/
    │   └─ messages_to_parse.dat
    │
    ├─ logs/
    │
    ├─ main.py
    └─ README.md

------------------------------------------------------------------------

## Примітки

-   У словнику `original_to_status` зберігаються всі 71 унікальний URL.
-   У словнику `original_to_unshortened` кількість ключів залежить від
    режиму.
-   Скорочені URL -- це ті, що ведуть через сервіси типу `bit.ly` (скорочувачі).
